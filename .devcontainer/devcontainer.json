// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/ubuntu
{
  "name": "locust-tests",
  // Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
  "image": "mcr.microsoft.com/devcontainers/python:3.14",
  "runArgs": [
    "--network=host"
  ],
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "moby": false,
      "azureDnsAutoDetection": true,
      "installDockerBuildx": true,
      "version": "latest",
      "dockerDashComposeVersion": "v2"
    },
    "ghcr.io/devcontainers-extra/features/poetry:2": {
      "version": "latest"
    },
    "ghcr.io/devcontainers-extra/features/pipenv:2": {
      "version": "latest"
    },
    "ghcr.io/rocker-org/devcontainer-features/apt-packages:1": {
      "packages": "make,yq"
    }
  },
  "containerEnv": {
    "REQUESTS_CA_BUNDLE": "/etc/ssl/certs/ca-certificates.crt"
  },
  "mounts": [
    "source=${localEnv:HOME}${localEnv:USERPROFILE}/.ssh,target=/home/vscode/.ssh,type=bind"
    // "source=${localEnv:HOME}${localEnv:USERPROFILE}/.azure,target=/home/vscode/.azure,type=bind"
  ],
  // Features to add to the dev container. More info: https://containers.dev/features.
  // "features": {},
  // Use 'forwardPorts' to make a list of ports inside the container available locally.
  // "forwardPorts": [],
  // Configure project
//   "postCreateCommand": "make configure",
  // Configure tool-specific properties.
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.makefile-tools",
        "ms-azuretools.vscode-docker",
        "ms-python.black-formatter",
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-python.isort", // isort import sorter (can also use Ruff)
        "ms-python.mypy-type-checker",
        "charliermarsh.ruff",
        "lextudio.restructuredtext",
        "swyddfa.esbonio",
        "vscode.json-language-features",
        "zainchen.json",
        "redhat.vscode-yaml",
        "dotjoshjohnson.xml",
        "DavidAnson.vscode-markdownlint",
        "esbenp.prettier-vscode",
        "njpwerner.autodocstring", // Python docstring generator
        "Gruntfuggly.todo-tree", // Highlight TODOs, FIXMEs
        "gitlab.gitlab-workflow"
      ],
      "settings": {
        "diffEditor.renderSideBySide": true,
        "editor.suggestSelection": "first",
        "editor.tabSize": 4,
        "editor.wordWrap": "bounded",
        "editor.wordWrapColumn": 200,
        "editor.bracketPairColorization.enabled": true,
        "editor.bracketPairColorization.independentColorPoolPerBracketType": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "editor.formatOnSaveMode": "modificationsIfAvailable",
        "editor.guides.bracketPairs": true,

        "files.insertFinalNewline": true,
        "files.trimTrailingWhitespace": true,
        "files.autoSave": "onFocusChange",

        "explorer.confirmDelete": false,
        "explorer.confirmDragAndDrop": false,

        "files.exclude": {
          "**/.mypy_cache": true,
          "**/.classpath": true,
          "**/.DS_Store": true,
          "**/.factorypath": true,
          "**/.git": true,
          "**/.project": true,
          "**/.settings": true,
          "**/*.js": {
            "when": "$(basename).ts"
          },
          "**/*.js.map": true,
          "**/.svn": true,
          "**/.hg": true,
          "**/CVS": true,
          "**/Thumbs.db": true,
          "**/.venv": true, // Exclude virtual environment folders
          "**/.pytest_cache": true,
          "**/.ruff_cache": true,
          "**/__pycache__": true,
          "**/*.pyc": true,
          "**/build": true,
          "**/dist": true,
          "**/*.egg-info": true
        },
        "search.exclude": {
          "**/.mypy_cache": true,
          "**/node_modules": true,
          "**/.venv": true,
          "**/__pycache__": true,
          "**/packages": true,
          "**/.pytest_cache": true,
          "**/.ruff_cache": true,
          "**/*.pyc": true,
          "**/build": true,
          "**/dist": true,
          "**/*.egg-info": true,
          "**/bower_components": true
        },
        "telemetry.telemetryLevel": "off",
        // "workbench.colorTheme": "Dark Modern",

        "python.defaultInterpreterPath": "./.venv/bin/python",
        "[python]": {
          "editor.formatOnSave": true,
          "editor.defaultFormatter": "ms-python.black-formatter",
          "languageServer": "Pylance",
          "editor.codeActionsOnSave": {
            // Use Ruff (or isort if configured) to organize imports on save
            "source.organizeImports": "explicit",
            "source.fixAll": "explicit"
          }
        },
        "python.envFile": "${workspaceFolder}/.env",
        "python.linting.enabled": true,
        "python.linting.ruffEnabled": true, // Enable Ruff linter
        "python.linting.pylintEnabled": false, // Disable pylint (using Ruff)
        "python.linting.flake8Enabled": false, // Disable flake8 (using Ruff)
        // --- Python Formatting (Black - ms-python.black-formatter) ---
        "python.formatting.provider": "black", // Explicitly set Black as formatter provider
        "python.formatting.blackArgs": [], // Add any specific Black arguments if needed

        // --- AutoDocstring (njpwerner.autodocstring) ---
        "autoDocstring.docstringFormat": "google", // Options: google, numpy, sphinx, etc.

        // --- Python Language Server (Pylance - ms-python.vscode-pylance) ---
        // Type Checking Mode (Optional)
        // "python.analysis.typeCheckingMode": "basic", // Options: "off", "basic", "strict"
        // Tells Pylance where the source code is mounted inside the container
        "python.analysis.extraPaths": [
          "/workspaces/${containerWorkspaceFolderBasename}"
          // Add paths to other source directories if needed, relative to the workspace root
          // e.g., "/workspaces/${containerWorkspaceFolderBasename}/src"
        ],
        "[mypy-type-checker]": {},
        "[json]": {
          "editor.defaultFormatter": "vscode.json-language-features",
          "editor.formatOnPaste": true,
          "editor.formatOnSave": true,
          "editor.formatOnType": true,
          "editor.trimAutoWhitespace": true
        },
        "[md]": {
          "editor.defaultFormatter": "DavidAnson.vscode-markdownlint",
          "editor.formatOnPaste": true,
          "editor.formatOnSave": false,
          "editor.formatOnType": true,
          "editor.trimAutoWhitespace": true,
          "editor.wordWrap": "bounded",
          "editor.wordWrapColumn": 100,
          "editor.rulers": [100]
        },
        "[dockerfile]": {
          "editor.defaultFormatter": "ms-azuretools.vscode-containers"
        },
        "[makefile]": {
          "editor.defaultFormatter": "ms-vscode.makefile-tools",
          "editor.formatOnSave": true,
          "editor.insertSpaces": false
        },
        "[yaml]": {
          "editor.defaultFormatter": "redhat.vscode-yaml"
        },
        "[xml]": {
          "editor.defaultFormatter": "DotJoshJohnson.xml",
          "editor.tabSize": 2
        },
        "[docker]": {
          "editor.defaultFormatter": "ms-azuretools.vscode-containers"
        },
        // --- TODO Tree (Gruntfuggly.todo-tree) ---
        // You can customize highlighting and tags here if needed, e.g.:
        "todo-tree.highlights.customHighlight": {
          "TODO": { "icon": "check", "type": "tag" },
          "FIXME": { "icon": "beaker", "foreground": "#ff0000" }
        }
      }
    }
  },
  "remoteUser": "vscode"
}
